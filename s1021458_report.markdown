# RAID
容錯式磁碟陣列（RAID, Redundant Array of Independent Disks），舊稱容錯式廉價磁碟陣列（Redundant Array of Inexpensive Disks），簡稱磁碟陣列。

在電腦發展的初期，「大容量」硬碟的價格還相當高，解決資料存儲安全性問題的主要方法是使用磁帶機等設備進行備份，這種方法雖然可以保證資料的安全，但查閱和備份工作都相當繁瑣。1987年， Patterson、Gibson和Katz這三位工程師在加州大學伯克利分校發表了**《A Case of Redundant Array of Inexpensive Disks（廉價磁片冗餘陣列方案）》**的論文，其基本思想就是將多隻容量較小的、相對廉價的硬碟驅動器進行有機組合，使其性能超過一隻昂貴的大硬碟。這一設計思想很快被接受，從此RAID技術得到了廣泛應用，資料存儲進入了更快速、更安全、更廉價的新時代。 

RAID的優點比單顆硬碟多了以下幾種好處：
	
	  - 增強容錯功能
	  - 價格更便宜
	  - 儲存速度更快速
	  - 資料整合度提高 

另外，磁碟陣列對於電腦來說，看起來就像一個單獨的硬碟或邏輯存儲單元。分為RAID-0，RAID-1，RAID-1E，RAID-5，RAID-6，RAID-7，RAID-10，RAID-50，RAID-60。

簡單來說，RAID把多個硬碟組合成為一個邏輯磁區，因此，作業系統只會把它當作一個硬碟。RAID常被用在伺服器電腦上，並且常使用完全相同的硬碟作為組合。由於硬碟價格的不斷下降與RAID功能更加有效地與主機板整合，它也成為玩家的一個選擇，特別是需要大容量儲存空間的工作，如：視訊與音訊製作。

最初的RAID分成了不同的等級，每種等級都有其理論上的優缺點，不同的等級在兩個目標間取得平衡，分別是增加資料可靠性以及增加記憶體（群）讀寫效能。這些年來，出現了對於RAID觀念不同的應用。

[TOC]

##**標準RAID**

RAID技術主要包含RAID 0～RAID 7等數個規範，它們的側重點各不相同，常見的規範有如下幾種： 

###**RAID 0：**

	是將兩個以上的磁碟並聯起來，成為一個大容量的磁碟。RAID 0連續以位元或位元組單位分割資料，並行讀/寫於多個磁片上，因此具有很高的資料傳輸率，但它沒有資料冗餘，因此並不能算是真正的RAID結構。 RAID 0只是單純地提高性能，並沒有資料的可靠性提供保證，而且其中的一個磁片失效將影響到所有資料，危險程度與JBOD相當。因此，RAID 0不能應用於資料安全性要求高的場合。 

###**RAID 1：**

	兩組以上的N個磁碟相互作鏡像，在一些多執行緒作業系統中能有很好的讀取速度，理論上讀取速度等於硬碟數量的倍數，另外寫入速度有微小的降低。當原始資料繁忙時，可直接從鏡像拷貝中讀取資料，因此RAID 1可以提高讀取性能。RAID 1是磁碟陣列中單位成本最高的，但提供了很高的資料安全性和可用性。當一個磁片失效時，系統可以自動切換到鏡像磁片上讀寫，而不需要重組失效的資料。 但無論用多少磁碟做RAID 1，僅算一個磁碟的容量，是所有RAID中磁碟利用率最低的一個級別。

	如果用兩個不同大小的磁碟建RAID 1，可用空間為較小的那個磁碟，較大的磁碟多出來的空間也可以分割成一個區來使用，不會造成浪費。

###**RAID 0+1: **

	也被稱RAID 10標準，實際是將RAID 0和RAID 1標準結合的?物，在連續地以位元或位元組?單位分割資料並且並行讀/寫多個磁片的同時，每一塊磁片作磁片鏡像進行冗餘。它的優點是同時擁有RAID 0的超凡速度和RAID 1的資料高可靠性，但是CPU佔用率同樣也更高，而且磁片的利用率比較低。 

###**RAID 2：**

	RAID 0的改良版，以漢明碼（Hamming Code）的方式將資料進行編碼後分割為獨立的位元，並將資料分別寫入硬碟中。這種編碼技術需要多個磁片存放檢查及恢復資訊，使得RAID 2技術實施更複雜，也因為在資料中加入了錯誤修正碼（ECC，Error Correction Code），所以資料整體的容量會比原始資料大一些，因此在商業環境中很少使用。 

###**RAID 3：**

	它同RAID 2非常類似，都是將資料條塊化分佈於不同的硬碟上，區別在於RAID 3採用Bit－interleaving（資料交錯儲存）技術，並用單塊磁片存放奇偶校驗資訊。如果一塊磁片失效，奇偶盤及其它資料盤可以重新生資料；如果奇偶盤失效則不影響資料使用。 RAID 3對於大量的連續資料可提供很好的傳輸率，但由於資料內的位元分散在不同的硬碟上，因此就算要讀取一小段資料資料都可能需要所有的硬碟進行工作，所以這種規格比較適於讀取大量資料時使用。

###**RAID 4：**

	RAID 4同樣也將資料條塊化並分佈於不同的磁片上，但與RAID 3不同的是它在分割時是以區塊為單位分別存在硬碟中，，但每次的資料存取都必須從同位元檢查的那個硬碟中取出對應的同位元資料進行核對，由於過於頻繁的使用，所以對硬碟的損耗可能會提高，因此RAID 4在商業環境中也很少使用。 

###**RAID 5：**

	RAID 5不單獨指定的奇偶盤，而是在所有磁片上交叉地存取資料及奇偶校驗資訊。在RAID 5上，使用的是Disk Striping（硬碟分割）技術，讀/寫指標可同時對陣列設備進行操作，提供了更高的資料流程量。RAID 5不是對儲存的資料進行備份，而是把資料和相對應的奇偶校驗資訊儲存到組成RAID5的各個磁碟上，並且奇偶校驗資訊和相對應的資料分別儲存於不同的磁碟上。當RAID5的一個磁碟資料發生損壞後，可以利用剩下的資料和相應的奇偶校驗資訊去恢復被損壞的資料。RAID 5可以理解為是RAID 0和RAID 1的折衷方案。RAID 5可以為系統提供資料安全保障，但保障程度要比鏡像低而磁碟空間利用率要比鏡像高。RAID 5具有和RAID 0相近似的資料讀取速度，只是因為多了一個奇偶校驗資訊，寫入資料的速度相對單獨寫入一塊硬碟的速度略慢，若使用「回寫快取」可以讓效能改善不少。同時由於多個資料對應一個奇偶校驗資訊，RAID 5的磁碟空間利用率要比RAID 1高，儲存成本相對較便宜。

###**RAID 6：**

	與RAID 5相比，RAID 6增加了第二個獨立的奇偶校驗資訊塊。兩個獨立的奇偶系統使用不同的演算法，資料的可靠性非常高，即使兩塊磁片同時失效也不會影響資料的使用。但RAID 6需要分配給奇偶校驗資訊更大的磁碟空間，相對於RAID 5有更大的IO操作量和計算量，其「寫效能」強烈取決於具體的實作方案，因此RAID6通常不會通過軟體方式來實作，而更可能通過硬體/韌體方式實作。

	同一陣列中最多容許兩個磁碟損壞。更換新磁碟後，資料將會重新算出並寫入新的磁碟中。依照設計理論，RAID 6必須具備四個以上的磁碟才能生效。


##**混合RAID**

###**JBOD（ Just a Bunch Of Disks）：**

	嚴格上來講，JBOD 應該不能算在 RAID 等級中，由於並沒有規範，市場上有兩類主流的做法：
	
		1.使用單獨的連結埠如SATA、USB或1394同時控制多個各別獨立的硬碟，使用這種模式通    常長較高階的裝置，還具備有RAID的功能，不需要依靠JBOD達到合併邏輯磁區的目的。
		
	    2.只是將多個硬碟空間合併成一個大的邏輯硬碟，沒有錯誤備援機制：
	    資料的存放機制是由第一顆硬碟開始依序往後存放，即作業系統看到的是一個大硬碟（由許多小硬碟組成的）。但如果硬碟損毀，則該顆硬碟上的所有資料將「無法」救回。若第一顆硬碟損壞，通常無法作救援（因為大部分檔案系統將磁碟分割表（partition table）‎存在磁碟前端，即第一顆），失去磁碟分割表即失去一切資料，若遭遇磁碟陣列資料或硬碟出錯的狀況，危險程度較RAID 0更劇。它的好處是不會像RAID，每次存取都要讀寫全部硬碟。
	    

###**RAID 7：**

	這是一種新的RAID標準，並非公開的RAID標準，而是Storage Computer Corporation的專利硬體產品名稱，以RAID 3及RAID 4為基礎所發展，但是經過強化以解決原來的一些限制。。其自身帶有智慧化即時操作系統和用於存儲管理的軟體工具，可完全獨立於主機運行，不佔用主機CPU資源。RAID 7可以看作是一種存儲電腦（Storage Computer），可以同時處理大量的IO要求，所以效能甚至超越了許多其他RAID標準的實做產品。但也因為如此，在價格方面非常的高昂。 

###**RAID 10/01：**

	RAID 10是先鏡射再分割資料，再將所有硬碟分為兩組，視為是RAID 0的最低組合，然後將這兩組各自視為RAID 1運作。

	RAID 01則是跟RAID 10的程式相反，是先分割再將資料鏡射到兩組硬碟。它將所有的硬碟分為兩組，變成RAID 1的最低組合，而將兩組硬碟各自視為RAID 0運作。

	當RAID 10有一個硬碟受損，其餘硬碟會繼續運作。RAID 01只要有一個硬碟受損，同組RAID 0的所有硬碟都會停止運作，只剩下其他組的硬碟運作，可靠性較低。如果以六個硬碟建RAID 01，鏡射再用三個建RAID 0，那麼壞一個硬碟便會有三個硬碟離線。因此，RAID 10遠較RAID 01常用，零售主機板絕大部份支援RAID 0/1/5/10，但不支援RAID 01。

###**RAID 50：**

	RAID 5與RAID 0的組合，先作RAID 5，再作RAID 0，也就是對多組RAID 5彼此構成Stripe存取。由於RAID 50是以RAID 5為基礎，而RAID 5至少需要3顆硬碟，因此要以多組RAID 5構成RAID 50，至少需要6顆硬碟。以RAID 50最小的6顆硬碟組態為例，先把6顆硬碟分為2組，每組3顆構成RAID 5，如此就得到兩組RAID 5，然後再把兩組RAID 5構成RAID 0。

	RAID 50在底層的任一組或多組RAID 5中出現1顆硬碟損壞時，仍能維持運作，不過如果任一組RAID 5中出現2顆或2顆以上硬碟損毀，整組RAID 50就會失效。

	RAID 50由於在上層把多組RAID 5構成Stripe，效能比起單純的RAID 5高，容量利用率比RAID5要低。比如同樣使用9顆硬碟，由各3顆RAID 5再組成RAID 0的RAID 50，每組RAID 5浪費一顆硬碟，利用率為(1-3/9)，RAID 5則為(1-1/9)。

###**RAID 60：**

	RAID 6與RAID 0的組合：先作RAID 6，再作RAID 0。換句話說，就是對兩組以上的RAID 6作Stripe存取。RAID 6至少需具備4顆硬碟，所以RAID 60的最小需求是8顆硬碟。

	由於底層是以RAID 6組成，所以RAID 60可以容許任一組RAID 6中損毀最多2顆硬碟，而系統仍能維持運作；不過只要底層任一組RAID 6中損毀3顆硬碟，整組RAID 60就會失效，當然這種情況的機率相當低。

	比起單純的RAID 6，RAID 60的上層透過結合多組RAID 6構成Stripe存取，因此效能較高。不過使用門檻高，而且容量利用率低是較大的問題。


##**結語**

	除了以上的各種標準，我們可以如RAID 0+1那樣結合多種RAID規範來構築所需的RAID陣列，例如RAID 5+3（RAID 53）就是一種應用較廣泛的陣列形式。用戶一般可以通過靈活配置磁碟陣列來獲得更加符合其要求的磁片存儲系統。 

	開始時RAID方案主要針對SCSI硬碟系統，系統成本比較昂貴。1993年，HighPoint公司推出了第一款IDE-RAID控制晶片，能夠利用相對廉價的IDE硬碟來組建RAID系統，從而大大降低了RAID的「門檻」。從此，個人用戶也開始關注這項技術，因硬碟是現代個人電腦中發展最「 緩慢」和最缺少安全性的設備，而用戶存儲在其中的資料卻常常遠超電腦的本身價格。在花費相對較少的情況下，RAID技術可以使個人用戶也享受到成倍的磁速度提升和更高的資料安全性，現在個人電腦市場上的IDE-RAID控制晶片主要出自HighPoint和Promise公司，此外還有一部分來自 AMI公司（如表2）。 
	　　
	面向個人用戶的IDE-RAID晶片一般只提供了RAID 0、RAID 1和RAID 0+1（RAID 10）等RAID規範的支援，雖然它們在技術上無法與商用系統相提並論，但是對普通用戶來說其提供的速度提升和安全保證已經足夠了。隨著硬碟介面傳輸率的 不斷提高，IDE-RAID晶片也不斷地更新換代，晶片市場上的主流晶片已經全部支援ATA 100標準，而HighPoint公司新推出的HPT 372晶片和Promise最新的PDC20276晶片，甚至已經可以支援ATA 133標準的IDE硬碟。 

	在主板廠商競爭加劇、個人電腦用戶要求逐漸提高的今天，在主板上板載RAID晶片的廠商已經不在少數，用戶完全可以不用購置RAID卡，直接組建自己的磁碟陣列，感受磁片狂飆的速度。 


##**磁碟陣列比較表**

RAID等級 |	最少硬碟|	最大容錯|	可用容量	|讀取效能|寫入效能|安全性|	目的
------  |---     |---    |---     |-------|------|------ |-----
單一硬碟 |	(參考)|     0|	    1|	     1|	    1|	無		
JBOD    |1       |	    0|	    n|	     1|	    1|差     |	增加容量|	
0	    |2	     |0	     |n	     |n	      |n	     |差     |追求最大容量、速度
1	    |2	     |n-1	|1       |n	      |1    |最高，一個正常即可|	追求最大安全性
5       |	3    | 	1	|n-1	|n-1      |	n-1	|高	|追求最大容量、最小預算	
6	    |4	     |2	    |n-2	|n-2      |	n-2	|安全性較RAID 5高	|同RAID 5，但較安全	
10	    |4	     |n/2	|n/2	|n	      |n/2	|安全性高|	綜合RAID 0/1優點，理論速度較快	

#**參考資料**
1. 維基百科 https://zh.wikipedia.org/wiki/RAID
2. 【NAS 怎麼玩】RAID 架構-資料的保險箱http://lbear.pixnet.net/blog/post/49922918
3. Intel  快速儲存技術 http://www.intel.com/support/tw/chipsets/imsm/sb/cs-09337.htm#raid0 
4. 陣列磁碟Raid教學~原理 http://lagunawang.pixnet.net/blog/post/2311801-%E9%99%A3%E5%88%97%E7%A3%81%E7%A2%9Fraid%E6%95%99%E5%AD%B8~%E5%8E%9F%E7%90%86-
